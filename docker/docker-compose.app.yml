version: "3.9"

services:
  backend-legacy:
    build:
      context: ..
      dockerfile: server/Dockerfile
    environment:
      MONGODB_URI: ${MONGODB_URI:?Set MONGODB_URI to your external MongoDB}
      MONGODB_DB: ${MONGODB_DB:-mealplanner}
      JWT_SECRET: ${JWT_SECRET:-please-change-me}
      JWT_EXP_MINUTES: ${JWT_EXP_MINUTES:-120}
      ADMIN_LOGIN: ${ADMIN_LOGIN:-admin}
      ADMIN_INITIAL_PASSWORD: ${ADMIN_INITIAL_PASSWORD:-ChangeMeNow123!}
    ports:
      - "8000:8000"
    restart: unless-stopped
    networks:
      default:
        aliases:
          - backend

  frontend:
    build:
      context: ..
      dockerfile: front/Dockerfile
      args:
        VITE_API_URL: ${VITE_API_URL:-/api}
    depends_on:
      - backend-legacy
    ports:
      - "5173:80"
    restart: unless-stopped
