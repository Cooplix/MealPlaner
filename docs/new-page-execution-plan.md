# План виконання: Нова сторінка Inventory Management

Дата: 2026-02-08  
Джерело вимог: `docs/NewPage.md`  
Формат виконання: покроково, через промпти виду `Реалізуй крок N з додавання нової сторінки`

## 1. Аналіз вимог з `NewPage.md`

На основі документа, нова частина застосунку складається з таких блоків:

1. Нова сторінка `Inventory Management` на роуті `/inventory`.
2. Дві вкладки:
- `Products` (загальні продукти).
- `Cat Food Tracker` (корм для кота).
3. Табличні списки, фільтри, CRUD-операції, зміна залишку (consume), статуси терміну придатності, статуси дозакупки.
4. Розрахункові поля:
- `expiryStatus` (`OK`, `<=14d`, `<=30d`, `EXPIRED`).
- `toBuy`/`restock`, якщо `quantity < minQty` з формулою на базі `maxQty`.
5. Календар подій (термін придатності, дозакупка).
6. Підтримка i18n для всіх нових текстів.
7. Backend API для `inventory` та `pet-inventory`, включно з `consume`.
8. Імпорт даних з Excel (one-time script + опціонально API upload).
9. Авторизація JWT і ізоляція даних по `userId`.

## 2. Важливо для міграції Python -> Java 25 + Spring Boot

Щоб не зробити подвійну роботу, реалізацію треба вести через контракт:

1. Спочатку фіксуємо backend-agnostic контракт (DTO + endpoint contract).
2. Python-реалізація є тимчасовою/перехідною (для швидкого запуску фічі).
3. Java/Spring реалізація має повторити той самий контракт без змін фронтенду.
4. Розрахунки `expiryStatus`/`toBuy` виносимо в спільні правила (документація + тест-кейси), щоб уникнути різного результату в Python і Java.
5. Зовнішня MongoDB лишається shared, але колекції і права доступу ізольовані на рівні БД/користувача.

## 3. План виконання по кроках

Кожен крок незалежно комітиться. Переходити до наступного кроку тільки після перевірки поточного.

### Крок 1. Зафіксувати API-контракт і бізнес-правила

Ціль:
- зафіксувати єдину специфікацію для Python і Java.

Що зробити:
- створити документ контракту для:
`/inventory`, `/inventory/{id}`, `/inventory/{id}/consume`,
`/pet-inventory`, `/pet-inventory/{id}`, `/pet-inventory/{id}/consume`.
- описати DTO: `InventoryItem`, `PetFoodItem`, `Create`, `Update`, `ConsumeRequest`.
- зафіксувати правила обчислень `expiryStatus`, `restockStatus`, `toBuy`.

Результат:
- документ в `docs/` з endpoint matrix + прикладами request/response.

Критерій готовності:
- фронтенд і обидва бекенди можуть реалізовуватися без зміни контракту.

Промпт:
- `Реалізуй крок 1 з додавання нової сторінки`

### Крок 2. Підготувати фронтенд-моделі та API-шар

Ціль:
- створити основу для UI без прив'язки до конкретної backend-реалізації.

Що зробити:
- додати типи `InventoryItem`, `PetFoodItem` у `front/src/types.ts` або окремий модуль.
- додати API-клієнт `front/src/api/inventory.ts` (list/get/create/update/delete/consume).
- додати утиліти обчислення статусів у `front/src/utils/inventoryStatus.ts`.

Результат:
- типізований API-шар + чисті функції для статусів.

Критерій готовності:
- `npm run lint` і `npm run build` проходять.

Промпт:
- `Реалізуй крок 2 з додавання нової сторінки`

### Крок 3. Додати маршрут і каркас сторінки `/inventory`

Ціль:
- ввести нову сторінку в навігацію.

Що зробити:
- додати роут `/inventory`.
- створити `InventoryPage` з вкладками `Products` і `CatFood`.
- підготувати базовий layout для таблиці, фільтрів, кнопок дій.

Результат:
- сторінка відкривається, вкладки перемикаються.

Критерій готовності:
- роут доступний і не ламає інші сторінки.

Промпт:
- `Реалізуй крок 3 з додавання нової сторінки`

### Крок 4. Реалізувати `Products` вкладку (читання + фільтри + статуси)

Ціль:
- показати інвентар продуктів з базовою аналітикою.

Що зробити:
- таблиця продуктів.
- фільтри за категорією, локацією, статусом.
- вивід `expiryStatus` і `restockStatus`.
- обчислення `toBuy`.

Результат:
- робочий список продуктів з фільтрацією.

Критерій готовності:
- статуси і `toBuy` відповідають формалізованим правилам.

Промпт:
- `Реалізуй крок 4 з додавання нової сторінки`

### Крок 5. Реалізувати CRUD для продуктів

Ціль:
- повний цикл керування продуктами.

Що зробити:
- `ProductFormModal` (create/edit).
- delete з confirm.
- інтеграція з API.

Результат:
- create/update/delete працюють з оновленням таблиці.

Критерій готовності:
- валідації полів працюють, помилки показуються коректно.

Промпт:
- `Реалізуй крок 5 з додавання нової сторінки`

### Крок 6. Реалізувати consume для продуктів

Ціль:
- дозволити списання залишку без редагування всього запису.

Що зробити:
- `ConsumeModal` або inline-action.
- виклик `/inventory/{id}/consume`.
- валідація `amount > 0` і заборона від'ємного результату.

Результат:
- кількість змінюється через окрему операцію.

Критерій готовності:
- при помилках повертається зрозумілий UX.

Промпт:
- `Реалізуй крок 6 з додавання нової сторінки`

### Крок 7. Реалізувати `Cat Food` вкладку (лист + CRUD + consume)

Ціль:
- додати окремий домен для корму кота.

Що зробити:
- таблиця для `pet-inventory`.
- форма `PetFoodFormModal`.
- операції CRUD + consume.

Результат:
- друга вкладка повністю функціональна.

Критерій готовності:
- дані котячого корму не змішуються з продуктами.

Промпт:
- `Реалізуй крок 7 з додавання нової сторінки`

### Крок 8. Додати календар подій інвентаря

Ціль:
- візуалізувати критичні події по датах.

Що зробити:
- побудувати `events` з `inventory` і `pet-inventory`.
- події: `expire`, `restock`.
- інтеграція у наявний calendar UI (або окремий блок сторінки).

Результат:
- календар/summary відображає нагадування.

Критерій готовності:
- правильна прив'язка подій до дат і типів.

Промпт:
- `Реалізуй крок 8 з додавання нової сторінки`

### Крок 9. Додати i18n ключі для нової сторінки

Ціль:
- повна локалізація нових елементів UI.

Що зробити:
- додати ключі в `en`, `uk`, `pl`.
- покрити заголовки, колонки, кнопки, статуси, повідомлення помилок.

Результат:
- нова сторінка перекладається всіма підтримуваними мовами.

Критерій готовності:
- немає fallback-ключів у UI.

Промпт:
- `Реалізуй крок 9 з додавання нової сторінки`

### Крок 10. Реалізувати Python backend (перехідний етап)

Ціль:
- швидко ввімкнути фічу на поточному FastAPI.

Що зробити:
- колекції: `inventoryItems`, `petInventoryItems`.
- Pydantic-схеми + роутери + JWT-захист + фільтри.
- CRUD + consume endpoints.
- валідації (`quantity`, `minQty <= maxQty`, `expiresAt`).

Результат:
- фронтенд працює проти Python-бекенду.

Критерій готовності:
- smoke/integration тести проходять.

Промпт:
- `Реалізуй крок 10 з додавання нової сторінки`

### Крок 11. Додати імпорт з Excel

Ціль:
- завантажити стартові дані з XLSX.

Що зробити:
- one-time script у `scripts/` для мапінгу колонок у `inventoryItems`.
- (опційно) backend endpoint `/inventory/import`.
- обробка дат `dd.mm.yyyy` / `dd.mm.yy`, null-значень, min/max.

Результат:
- дані імпортуються контрольовано і відтворювано.

Критерій готовності:
- тестовий файл імпортується без втрати критичних полів.

Промпт:
- `Реалізуй крок 11 з додавання нової сторінки`

### Крок 12. Реалізувати Java 25 + Spring Boot backend parity

Ціль:
- перенести новий модуль з Python на Java без змін фронтенду.

Що зробити:
- реалізувати `inventory` і `pet-inventory` у `server-java/` за контрактом кроку 1.
- додати security, validation, Mongo repositories, DTO mappers.
- додати contract tests (Python vs Java responses parity).

Результат:
- нова сторінка працює з Java-бекендом через той самий API.

Критерій готовності:
- фронтенд не змінюється при перемиканні backend target.

Промпт:
- `Реалізуй крок 12 з додавання нової сторінки`

### Крок 13. Cutover на Java-бекенд і стабілізація

Ціль:
- перевести production-трафік на Java реалізацію.

Що зробити:
- stage перевірка + regression.
- поетапне перемикання трафіку.
- rollback план на Python.

Результат:
- модуль inventory стабільно працює на Java/Spring.

Критерій готовності:
- немає blocker-дефектів після cutover.

Промпт:
- `Реалізуй крок 13 з додавання нової сторінки`

## 4. Порядок виконання (рекомендований)

1. Обов'язково спочатку: кроки 1-3.
2. Потім UI-функціонал: кроки 4-9.
3. Далі backend: кроки 10-11 (Python перехідно), потім 12-13 (Java цільово).

## 5. Шаблон запиту для подальшої роботи

Використовуй один із шаблонів:

1. `Реалізуй крок 4 з додавання нової сторінки`
2. `Реалізуй крок 10 з додавання нової сторінки`
3. `Реалізуй крок 12 з додавання нової сторінки`

Агент у відповіді має:
- виконати тільки обраний крок;
- прогнати релевантні перевірки;
- закомітити зміни окремим комітом.
